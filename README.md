# Docker-окружение для сервера 1С:Предприятие

Этот проект предоставляет готовое решение для быстрого развертывания сервера 1С:Предприятие и PostgreSQL в изолированных Docker-контейнерах.

## Основные возможности

* Автоматическая сборка образа сервера 1С с необходимыми зависимостями.
* Использование Docker Compose для простого управления сервисами (запуск, остановка).
* Сохранение данных PostgreSQL и настроек кластера 1С между перезапусками контейнеров.
* Настроенный CI/CD-пайплайн для автоматической публикации Docker-образа в Docker Hub с помощью GitHub Actions.

## Структура проекта

```
.
├── .github/workflows/      # Автоматизация GitHub Actions
│   └── docker-publish.yml  # Воркфлоу для публикации образа в Docker Hub
├── 1c-server/              # Все для сборки образа сервера 1С
│   ├── distr/              # Сюда нужно положить .deb дистрибутивы 1С (папка игнорируется Git)
│   ├── Dockerfile          # Инструкция по сборке образа 1С
│   └── start.sh            # Скрипт запуска служб 1С внутри контейнера
├── .gitignore              # Исключает файлы дистрибутивов из репозитория
└── docker-compose.yml      # Главный файл для оркестровки контейнеров
```

## Как использовать

### Предварительные требования

* Установленный [Docker](https://www.docker.com/get-started)
* Установленный [Docker Compose](https://docs.docker.com/compose/install/)

---

### Вариант 1: Сборка собственного образа

Этот способ подходит, если вы хотите собрать образ с определенной версией платформы 1С.

1. **Клонируйте репозиторий:**

    ```bash
    git clone https://github.com/defin85/1c-docker.git
    cd 1c-docker
    ```

2. **Поместите дистрибутивы 1С:**
    Скопируйте необходимые `.deb` файлы дистрибутива сервера 1С для Linux в папку `1c-server/distr/`.

3. **Настройте `docker-compose.yml`:**
    * В файле `docker-compose.yml` **ОБЯЗАТЕЛЬНО** смените пароль для PostgreSQL в переменной `POSTGRES_PASSWORD`.
    * Убедитесь, что для сервиса `1c-server` раскомментирована секция `build` и закомментирована строка `image:`:

        ```yaml
        # ...
        1c-server:
          build:
            context: ./1c-server
          # image: defin85/1c-server:latest 
          # ...
        ```

4. **Соберите и запустите контейнеры:**

    ```bash
    docker-compose up --build -d
    ```

    Команда `--build` заставит Docker собрать ваш локальный образ `1c-server` на основе `Dockerfile` и дистрибутивов.

---

### Вариант 2: Использование готового образа из Docker Hub

Этот вариант не требует наличия дистрибутивов 1С на локальной машине. Он использует образ, который был автоматически собран и опубликован с помощью GitHub Actions.

1. **Настройте `docker-compose.yml`:**
    * Убедитесь, что для сервиса `1c-server` закомментирована секция `build` и раскомментирована строка `image:`:

        ```yaml
        # ...
        1c-server:
          # build:
          #  context: ./1c-server
          image: defin85/1c-server:latest
          # ...
        ```

    * Не забудьте сменить пароль для PostgreSQL.

2. **Запустите контейнеры:**

    ```bash
    docker-compose up -d
    ```

    Docker автоматически скачает готовый образ `defin85/1c-server:latest` из Docker Hub.

## Автоматическая публикация образа

Этот репозиторий настроен на автоматическую сборку и публикацию Docker-образа `defin85/1c-server:latest` в Docker Hub при каждом `push` в ветку `main`. Процесс управляется файлом `.github/workflows/docker-publish.yml`.

Для работы автоматизации необходимо один раз настроить секреты `DOCKERHUB_USERNAME` и `DOCKERHUB_TOKEN` в настройках репозитория на GitHub (`Settings` > `Secrets and variables` > `Actions`).
